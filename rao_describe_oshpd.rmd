---
title: "Risk Adjusted Outcomes for Urologic Oncology"
subtitle: "Readmissions Modeling"
author: "Anobel Y Odisho, Ruth Etzioni, John L Gore"
date: "`r Sys.Date()`"
output: 
  tufterhandout::html_tufte_handout:
        theme: cosmo
        css: floating.css
        toc: yes
params:
    cohort: "RadNx"
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, fig.width=12, cache=F)
```

<!--- this inline CSS style is to alter horizontal table padding for stargazer tables -->
<style>
  td {
    padding-left: 3px;
    padding-right: 3px;
  }
</style>
  
```{r packages, cache=F}
# Data Cleaning Packages
library(lubridate)
library(plyr)
library(dplyr)
library(stringr)
library(tidyr)

# Graphics Packages
library(DT)
library(ggplot2)
library(ggthemes)
library(knitr)
library(RColorBrewer)
library(stargazer)

# Specialty/Stats Packages
library(icd)
library(ROCR)
library(lme4)
```

```{r constants.functions}
bg <- "#FCFCFA"
main1 <- "#ca0020"
acc1 <- "#f4a582"
main2 <- "#92c5de"
acc2 <- "#0571b0"
# this function takes arguments x=value, y=number of sig figs, prints mean +/- SD in html
prettyMeanSD <- function (x,y) {
  mean <- prettyNum(round(mean(x, na.rm=TRUE),y), big.mark = ",")
  sd <-  prettyNum(round(sd(x, na.rm=TRUE),y), big.mark = ",")
  paste(mean, " &plusmn; ",sd,sep="")
}

prettyMedianIQR <- function (x,y) {
  median <- prettyNum(round(median(x, na.rm=TRUE),y), big.mark = ",")
  tiles <- round(quantile(x, c(.25, .75), na.rm=TRUE),y)
  paste(median, " (",tiles[1], " - ", tiles[2], ")",sep="")
}

rocResult <- function (x) {
  # predict test data result
  pr <- predict(x, newdata=test, allow.new.levels=T)
  pr <- prediction(pr, test$isreadmit30dc)
  auc <- performance(pr, measure="auc") 
  auc <- round(auc@y.values[[1]],4)
  
  # Generate ROC Curve
  roc <- performance(pr, measure="tpr", x.measure="fpr")
  plot(roc, colorize=T)
  cat("AUC:", auc)
}

aucResult <- function(x) {
  # predict test data result
  pr <- predict(x, newdata=test, allow.new.levels=T)
  pr <- prediction(pr, test$isreadmit30dc)
  auc <- performance(pr, measure="auc") 
  auc <- round(auc@y.values[[1]],4)
  return(auc)
}

# create empty list that I will populate with results as we go
auc <- list()
```

```{r loaddata, cache=F}
# Load full dataset (12.5m obs)
# when loading the full data set, in chunk options set cache.lazy=F
# pt <- readRDS(file="rao_workingdata/pt.rds")
ptgu <- readRDS("rao_workingdata/ptgu.rds")

# List variables that will be scaled for models
toscale <- c("agyradmcentered", 
             "elixsum", 
             "bedsMean", "adcMean", "dsh_pctMean", "mcr_pctMean", "cmiMean",
             "ethwhite", "ethblack", "ethlatin", "ethasian", "ethother",
             "medianincome", "capincome", "housevalue",
             "edunohs",	"eduhs", "educollege", "empexec",
             "gini", "iceinc", "iceedu", "iceeth", "hoodzscore", 
             "km", "hours", 
             "los", "cohortmortality", "residentnum")

# scale and center variables
ptgu[,toscale] <- data.frame(lapply(ptgu[,toscale], scale, center=T, scale=T))
rm(toscale)

# make a disease specific cohort based on the parameter selected
# params <- list(); params$cohort="Cystectomy"
ptgucohort <- ptgu %>% 
  filter(!is.na(patzcta)) %>%
  filter(cohort==params$cohort)

# split data into training and validation cohorts
# Set random seed to reproduce results
set.seed(7)

# create an index variable which will allow splitting of training/test data without overlap
ptgucohort$index <- seq(1:nrow(ptgucohort))

# Group by OSHPD_ID, then take a 75% sample for training set
train <- ptgucohort %>%
  group_by(oshpd_id) %>%
  sample_frac(size=0.75, replace=F)
# anything that didnt make it into training set is put into a test set
test <- ptgucohort[!(ptgucohort$index %in% train$index),]

# remove index variables
ptgucohort <- ptgucohort %>% select(-index)
train <- train %>% select(-index)
test <- test %>% select(-index)
```

# Overall Summary
- Total Records: `r nrow(pt)`
- Records in GU specific cohort `r nrow(ptgu)`
- `r kable(t(table(ptgu$cohort)))`

```{r datafields, cache=F, results='asis'}
names(ptgucohort)
```

## Admission Dates
Overall GU Cohort
```{r overallGuCohortAdmissionDates}
kable(t(table(ptgu$cohort)))

ptgu %>%
  ggplot(aes(x=admtdate, weight=1)) + 
  # geom_histogram(aes(y=..density..), fill=main2, alpha=0.3, color="white") +
  geom_density(aes(y=..count.., color=cohort)) +
  scale_color_brewer(palette = "Dark2") + 
  theme_few() +
  theme(plot.background = element_rect(fill=bg), 
        legend.background= element_rect(fill=bg), 
        legend.title=element_blank()) + 
  labs(title="Admission Dates for GU Cohort", 
       y="Number of Admissions", 
       x="Admission Date")
```

## Readmissions
Overall Readmission Rates (%)
```{r overallReadmissionRate, results="asis"}
ptgu %>%
  group_by(cohort) %>%
  summarise(
    "30 Day Readmission" = sprintf("% .2f%%", 100*sum(isreadmit30dc)/n()),
    "90 Day Readmission" = sprintf("% .2f%%", 100*sum(isreadmit90dc)/n())
  ) %>% 
  kable()
```

```{r}
t <- ptgu %>%
  group_by(cohort) %>%
  filter(readmitdaysdc>0 & readmitdaysdc<90) %>%
  mutate(totalreadmits = n()) %>%
  group_by(readmitdaysdc, cohort, totalreadmits) %>%
  summarise(
    count = n(),
    proportion = 100*count/mean(totalreadmits))
  
ggplot(t) + 
  geom_smooth(aes(x=readmitdaysdc, y=proportion, color=cohort), span=0.25, se=F) +
  theme_few()

```

## Disposition
Overall Disposition Distribution (%)
```{r overallDispo, results="asis"}
t <- round(100*prop.table(table(ptgu$disp, ptgu$cohort),2),2)
kable(t)
```

## Race/Ethnicity
(%)
```{r overallRace, results="asis"}
t <- round(100*prop.table(table(ptgu$race_grp, ptgu$cohort),2),2)
kable(t)
```

## Payers
Payer Category (%)
```{r overallPayers, results="asis"}
t <- round(100*prop.table(table(ptgu$pay_cat, ptgu$cohort),2),2)
kable(t)
```
<br>

Payer Type (%)
```{r, results="asis"}
t <- round(100*prop.table(table(ptgu$pay_type, ptgu$cohort),2),2)
kable(t)

```

# `r params$cohort` Summary
- Records in `r params$cohort` specific cohort: `r nrow(ptgucohort)`
- For modeling, data split 75/25 into training (n=`r nrow(train)`) and testing (n=`r nrow(test)`) cohorts

# Fixed Effects
## Baseline Model
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex

```{r logmodel1}
m1 <- glm(isreadmit30dc ~ agyradmcentered + sex, data=train, family="binomial")

summary(m1)
rocResult(m1)
auc$m1$formula <- as.character(m1$formula)[3]
auc$m1$auc <- aucResult(m1)
```

Predicted Probability of Readmission
```{r logmodel1preds}
# Generate dataframe of dummy values to calculate predicted probabilities
# newm1 <- data.frame(
#   agyradmcentered = rep(seq(from=1.8, to=10, length.out = 100),2), 
#   sex=factor(c(rep("Male",100), rep("Female",100))))
# 
# p1 <- cbind(newm1,predict(m1, newdata = newm1, type="link", se=T))
# p1 <- within(p1, {
#     PredictedProb <- plogis(fit)
#     LL <- plogis(fit - (1.96 * se.fit))
#     UL <- plogis(fit + (1.96 * se.fit))
# })
# 
# ggplot(p1, aes(x = agyradmcentered*10, y = PredictedProb)) + 
#   geom_ribbon(aes(ymin = LL, ymax = UL, fill = sex), alpha = 0.1) + 
#   geom_line(aes(colour = sex), size = 1) + 
#   theme_few() +
#   theme(plot.background = element_rect(fill=bg), 
#         legend.background= element_rect(fill=bg), 
#         legend.title=element_blank())
```

## Elix Sum
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum

```{r logmodel2}
m2 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum, data=train, family="binomial")

summary(m2)
rocResult(m2)

auc$m2$formula <- as.character(m2$formula)[3]
auc$m2$auc <- aucResult(m2)
```

## Elix Index
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index (30 Categorical Vars)

```{r logmodel3}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open + ", paste(elixComorbidNamesAbbrev, collapse="+")))

m3 <- glm(fmla, data=train, family="binomial")

summary(m3)
rocResult(m3)

auc$m3$formula <- as.character(m3$formula)[3]
auc$m3$auc <- aucResult(m3)
```

## Elix, Hospital ID
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index (30 Categorical Vars), Hospital ID as fixed effect
- Turns out this doesnt work due to a large number of hospitals (170), leading to 170 dummy variables.

# Mixed Effects Models
## Baseline ME
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex
- Random Effect: Hospital

```{r MEmodel1}
me1 <- glmer(isreadmit30dc ~ agyradmcentered + sex + open +  (1|oshpd_id), data=train, family="binomial")

# print raw results of regression
summary(me1)
rocResult(me1)

auc$me1$formula <- as.character(me1@call)[2]
auc$me1$auc <- aucResult(me1)

```

## Elix Sum
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum. Hospital as random effect.
- Random Effect: Hospital

```{r MEmodel2}
me2 <- glmer(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + (1 | oshpd_id), data=train, family="binomial")

# print raw results of regression
summary(me2)
rocResult(me2)
auc$me2$formula <- as.character(me2@call)[2]
auc$me2$auc <- aucResult(me2)
```

## Elix Index
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index Categories. Hospital as random effect.
- Random Effect: Hospital

```{r MEmodel3}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open +  ", paste(elixComorbidNamesAbbrev, collapse="+"), " + (1 | oshpd_id)"))

me3 <- glmer(fmla, data=train, family="binomial")

# print raw results of regression
summary(me3)
rocResult(me3)
auc$me3$formula <- as.character(me3@call)[2]
auc$me3$auc <- aucResult(me3)
```

# Diez-Roux Models
## HoodZ
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex
- SES: Neighborhood Z-Score (continuous)

```{r MEmodel4a}
me4a <- glm(isreadmit30dc ~ agyradmcentered + sex  + open +  hoodzscore + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me4a)
rocResult(me4a)
auc$me4a$formula <- as.character(me4a$call)[2]
auc$me4a$auc <- aucResult(me4a)
```

## HoodZ
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score (continuous)

```{r MEmodel4b}
me4b <- glm(isreadmit30dc ~ agyradmcentered + sex  + open +  elixsum + hoodzscore + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me4b)
rocResult(me4b)
auc$me4b$formula <- as.character(me4b$call)[2]
auc$me4b$auc <- aucResult(me4b)
```

## HoodZ EthW
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score (continuous), Ethnicity (% white)

```{r MEmodel4c}
me4c <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me4c)
rocResult(me4c)
auc$me4c$formula <- as.character(me4c$call)[2]
auc$me4c$auc <- aucResult(me4c)
```

## HoodZ EthB
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score (continuous), Ethnicity (% black)

```{r MEmodel4d}
me4d <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethblack, data=train, family="binomial")

# print raw results of regression
summary(me4d)
rocResult(me4d)
auc$me4d$formula <- as.character(me4d$call)[2]
auc$me4d$auc <- aucResult(me4d)
```

## HoodZ Quintile
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score (quintile)

```{r MEmodel5a}
me5a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodquint, data=train, family="binomial")

# print raw results of regression
summary(me5a)
rocResult(me5a)
auc$me5a$formula <- as.character(me5a$call)[2]
auc$me5a$auc <- aucResult(me5a)
```

## HoodZ Quintile + Eth
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score (quintile), Eth White

```{r MEmodel5aethw}
me5aethw <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodquint + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me5aethw)
rocResult(me5aethw)
auc$me5aethw$formula <- as.character(me5aethw$call)[2]
auc$me5aethw$auc <- aucResult(me5aethw)
```


## Elix Index, HoodZ
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index Categories
- SES: Neighborhood Z-Score 
- Hospital as random effect

```{r MEmodel6}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open +  hoodzscore +", paste(elixComorbidNamesAbbrev, collapse="+"), ""))

me6 <- glm(fmla, data=train, family="binomial")

# print raw results of regression
summary(me6)
rocResult(me6)
auc$me6$formula <- as.character(fmla[3])
auc$me6$auc <- aucResult(me6)
```

## Elix Index, HoodZ, EthW
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index Categories
- SES: Neighborhood Z-Score, Ethnicity (% white)

```{r MEmodel6a}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open +  hoodzscore + ethwhite + ", paste(elixComorbidNamesAbbrev, collapse="+"), ""))

me6a <- glm(fmla, data=train, family="binomial")

# print raw results of regression
summary(me6a)
rocResult(me6a)
auc$me6a$formula <- as.character(fmla[3])
auc$me6a$auc <- aucResult(me6a)
```

## Elix Index, HoodZ, EthB
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index Categories
- SES: Neighborhood Z-Score, Ethnicity (% black)

```{r MEmodel6b}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open +  hoodzscore + ethblack + ", paste(elixComorbidNamesAbbrev, collapse="+"), ""))

me6b <- glm(fmla, data=train, family="binomial")

# print raw results of regression
summary(me6b)
rocResult(me6b)
auc$me6b$formula <- as.character(fmla[3])
auc$me6b$auc <- aucResult(me6b)
```

## Elix Index, HoodZ Quintile
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Index Categories
- SES: Neighborhood Z-Score Quintile

```{r MEmodel7}
fmla <- as.formula(paste("isreadmit30dc ~ agyradmcentered + sex + open +  hoodquint +", paste(elixComorbidNamesAbbrev, collapse="+"), ""))

me7 <- glm(fmla, data=train, family="binomial")

# print raw results of regression
summary(me7)
rocResult(me7)
auc$me7$formula <- as.character(fmla[3])
auc$me7$auc <- aucResult(me7)
```

# SES Categories

## Eth (White)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Race_group (for the patient, from OSHPD)

```{r MEmodel8}
me8 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + race_grp, data=train, family="binomial")

# print raw results of regression
summary(me8)
rocResult(me8)
auc$me8$formula <- as.character(me8$call)[2]
auc$me8$auc <- aucResult(me8)
```

## Eth (White)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Ethnicity (% White)

```{r MEmodel9a}
me9a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me9a)
rocResult(me9a)
auc$me9a$formula <- as.character(me9a$call)[2]
auc$me9a$auc <- aucResult(me9a)
```

## Eth(AfAm)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Ethnicity (% African American)

```{r MEmodel9}
me9b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + ethblack, data=train, family="binomial")

# print raw results of regression
summary(me9b)
rocResult(me9b)
auc$me9b$formula <- as.character(me9b$call)[2]
auc$me9b$auc <- aucResult(me9b)
```

## Income
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Median Income

```{r MEmodel10}
me10 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + medianincome1k, data=train, family="binomial")

# print raw results of regression
summary(me10)
rocResult(me10)
auc$me10$formula <- as.character(me10$call)[2]
auc$me10$auc <- aucResult(me10)
```

## Home Value
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Median Home Value

```{r MEmodel11}
me11 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + housevalue100k, data=train, family="binomial")

# print raw results of regression
summary(me11)
rocResult(me11)
auc$me11$formula <- as.character(me11$call)[2]
auc$me11$auc <- aucResult(me11)
```

## Cap Income
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: % households with Capital Income

```{r MEmodel12}
me12 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + capincome, data=train, family="binomial")

# print raw results of regression
summary(me12)
rocResult(me12)
auc$me12$formula <- as.character(me12$call)[2]
auc$me12$auc <- aucResult(me12)
```

## Edu (HS)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Education (% that completed HS)

```{r MEmodel13}
me13 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + eduhs, data=train, family="binomial")

# print raw results of regression
summary(me13)
rocResult(me13)
auc$me13$formula <- as.character(me13$call)[2]
auc$me13$auc <- aucResult(me13)
```

## Edu(College)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Education (% that did complete College)

```{r MEmodel15}
me15 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + educollege, data=train, family="binomial")

# print raw results of regression
summary(me15)
rocResult(me15)
auc$me15$formula <- as.character(me15$call)[2]
auc$me15$auc <- aucResult(me15)
```

## Employment
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: % Employed in Executive Positions

```{r MEmodel16}
me16 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + empexec, data=train, family="binomial")

# print raw results of regression
summary(me16)
rocResult(me16)
auc$me16$formula <- as.character(me16$call)[2]
auc$me16$auc <- aucResult(me16)
```

## Diez-Roux independently
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: All components of DiezRoux Index individually

```{r MEmodel17}
me17 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + ethwhite + medianincome1k + housevalue100k + capincome + eduhs + educollege + empexec, data=train, family="binomial")

# print raw results of regression
summary(me17)
rocResult(me17)
auc$me17$formula <- as.character(me17$call)[2]
auc$me17$auc <- aucResult(me17)
```

## GINI
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: GINI Coefficient of Inequality

```{r MEmodel18}
me18 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + gini, data=train, family="binomial")

# print raw results of regression
summary(me18)
rocResult(me18)
auc$me18$formula <- as.character(me18$call)[2]
auc$me18$auc <- aucResult(me18)
```

## ICE Income
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Index for Concentration at the Extremes for Income

```{r MEmodel19}
me19 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + iceinc, data=train, family="binomial")

# print raw results of regression
summary(me19)
rocResult(me19)
auc$me19$formula <- as.character(me19$call)[2]
auc$me19$auc <- aucResult(me19)
```

## ICE Education
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Index for Concentration at the Extremes for Education

```{r MEmodel20}
me20 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + iceedu, data=train, family="binomial")

# print raw results of regression
summary(me20)
rocResult(me20)
auc$me20$formula <- as.character(me20$call)[2]
auc$me20$auc <- aucResult(me20)
```

## ICE Ethnicity
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Index for Concentration at the Extremes for Ethnicity

```{r MEmodel21}
me21 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + iceeth, data=train, family="binomial")

# print raw results of regression
summary(me21)
rocResult(me21)
auc$me21$formula <- as.character(me21$call)[2]
auc$me21$auc <- aucResult(me21)
```

## ICE (all)
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Index for Concentration at the Extremes for Income, Ethnicity, Education

```{r MEmodel22}
me22 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + iceinc + iceedu + iceeth, data=train, family="binomial")

# print raw results of regression
summary(me22)
rocResult(me22)
auc$me22$formula <- as.character(me22$call)[2]
auc$me22$auc <- aucResult(me22)
```

# Hosp Factors
## Volume
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Hospital `r params$cohort` volume
- SES: None

```{r MEmodel23}
me23 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + volume, data=train, family="binomial")

# print raw results of regression
summary(me23)
rocResult(me23)
auc$me23$formula <- as.character(me23$call)[2]
auc$me23$auc <- aucResult(me23)
```

## Volume, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Hospital `r params$cohort` volume
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel23b}
me23b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + volume, data=train, family="binomial")

# print raw results of regression
summary(me23b)
rocResult(me23b)
auc$me23b$formula <- as.character(me23b$call)[2]
auc$me23b$auc <- aucResult(me23b)
```

## Volume Quintile
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Hospital `r params$cohort` volume quintile
- SES: None

```{r MEmodel24a}
me24a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + volumequint, data=train, family="binomial")

# print raw results of regression
summary(me24a)
rocResult(me24a)
auc$me24a$formula <- as.character(me24a$call)[2]
auc$me24a$auc <- aucResult(me24a)
```

## Volume Quintile, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Hospital `r params$cohort` volume quintile
- SES: Diez-Roux, Ethnicity (White)

```{r MEmodel24b}
me24b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + volumequint, data=train, family="binomial")

# print raw results of regression
summary(me24b)
rocResult(me24b)
auc$me24b$formula <- as.character(me24b$call)[2]
auc$me24b$auc <- aucResult(me24b)
```

## Hospital Beds
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Number of hospital beds
- SES: None

```{r MEmodel25}
me25 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + bedsMean, data=train, family="binomial")

# print raw results of regression
summary(me25)
rocResult(me25)
auc$me25$formula <- as.character(me25$call)[2]
auc$me25$auc <- aucResult(me25)
```

## Hospital Beds, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Number of hospital beds
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel25b}
me25b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + bedsMean, data=train, family="binomial")

# print raw results of regression
summary(me25b)
rocResult(me25b)
auc$me25b$formula <- as.character(me25b$call)[2]
auc$me25b$auc <- aucResult(me25b)
```

## Average Daily Census
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Average Daily Census
- SES: None

```{r MEmodel26}
me26 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + adcMean, data=train, family="binomial")

# print raw results of regression
summary(me26)
rocResult(me26)
auc$me26$formula <- as.character(me26$call)[2]
auc$me26$auc <- aucResult(me26)
```

## Average Daily Census, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Average Daily Census
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel26b}
me26b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + adcMean, data=train, family="binomial")

# print raw results of regression
summary(me26b)
rocResult(me26b)
auc$me26b$formula <- as.character(me26b$call)[2]
auc$me26b$auc <- aucResult(me26b)
```

## Medicare DSH
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Disproportionate Share Index
- SES: None

```{r MEmodel27a}
me27a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + dsh_pctMean, data=train, family="binomial")

# print raw results of regression
summary(me27a)
rocResult(me27a)
auc$me27a$formula <- as.character(me27a$call)[2]
auc$me27a$auc <- aucResult(me27a)
```

## Medicare DSH, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Disproportionate Share Index
- SES: HoodZscore, Ethnicity (white)

```{r MEmodel27b}
me27b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + dsh_pctMean, data=train, family="binomial")

# print raw results of regression
summary(me27b)
rocResult(me27b)
auc$me27b$formula <- as.character(me27b$call)[2]
auc$me27b$auc <- aucResult(me27b)
```

## Safety Net DSH
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Safety Net Hospital Status
- SES: None

```{r MEmodel28a}
me28a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + safetydsh, data=train, family="binomial")

# print raw results of regression
summary(me28a)
rocResult(me28a)
auc$me28a$formula <- as.character(me28a$call)[2]
auc$me28a$auc <- aucResult(me28a)
```

## Safety Net DSH, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Safety Net Hospital Status
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel28b}
me28b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + safetydsh, data=train, family="binomial")

# print raw results of regression
summary(me28b)
rocResult(me28b)
auc$me28b$formula <- as.character(me28b$call)[2]
auc$me28b$auc <- aucResult(me28b)
```

## Safety Net NAPH
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Safety Net Hospital Status (NAPH)
- SES: None

```{r MEmodel29a}
me29a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + safetynaph, data=train, family="binomial")

# print raw results of regression
summary(me29a)
rocResult(me29a)
auc$me29a$formula <- as.character(me29a$call)[2]
auc$me29a$auc <- aucResult(me29a)
```

## Safety Net NAPH, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Safety Net Hospital Status (NAPH)
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel29b}
me29b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + safetynaph, data=train, family="binomial")

# print raw results of regression
summary(me29b)
rocResult(me29b)
auc$me29b$formula <- as.character(me29b$call)[2]
auc$me29b$auc <- aucResult(me29b)
```

## Medicare %
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Meidcare %
- SES: None

```{r MEmodel30a}
me30a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + mcr_pctMean, data=train, family="binomial")

# print raw results of regression
summary(me30a)
rocResult(me30a)
auc$me30a$formula <- as.character(me30a$call)[2]
auc$me30a$auc <- aucResult(me30a)
```

## Medicare %, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Meidcare %
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel30b}
me30b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + mcr_pctMean, data=train, family="binomial")

# print raw results of regression
summary(me30b)
rocResult(me30b)
auc$me30b$formula <- as.character(me30b$call)[2]
auc$me30b$auc <- aucResult(me30b)
```

## Case Mix
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Case Mix Index
- SES: None

```{r MEmodel31a}
me31a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + cmiMean, data=train, family="binomial")

# print raw results of regression
summary(me31a)
rocResult(me31a)

auc$me31a$formula <- as.character(me31a$call)[2]
auc$me31a$auc <- aucResult(me31a)
```

## Case Mix, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Case Mix Index
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel31b}
me31b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + cmiMean, data=train, family="binomial")

# print raw results of regression
summary(me31b)
rocResult(me31b)

auc$me31b$formula <- as.character(me31b$call)[2]
auc$me31b$auc <- aucResult(me31b)
```

## Hosp Comb
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Beds, DSH, Medicare Percentage, Case Mix Index
- SES: None

```{r MEmodel32}
me32 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + bedsMean + dsh_pctMean + mcr_pctMean + cmiMean, data=train, family="binomial")

# print raw results of regression
summary(me32)
rocResult(me32)
auc$me32$formula <- as.character(me32$call)[2]
auc$me32$auc <- aucResult(me32)
```

## Mortality
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Cohort specific in-hospital mortality rate
- SES: None

```{r MEmodel33a}
me33a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + cohortmortality, data=train, family="binomial")

# print raw results of regression
summary(me33a)
rocResult(me33a)
auc$me33a$formula <- as.character(me33a$call)[2]
auc$me33a$auc <- aucResult(me33a)
```

## Mortality
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Cohort specific in-hospital mortality rate
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel33b}
me33b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + cohortmortality, data=train, family="binomial")

# print raw results of regression
summary(me33b)
rocResult(me33b)
auc$me33b$formula <- as.character(me33b$call)[2]
auc$me33b$auc <- aucResult(me33b)
```

## Academic: Any
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: residency
- SES: None

```{r MEmodel35a}
me35a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + residency, data=train, family="binomial")

# print raw results of regression
summary(me35a)
rocResult(me35a)
auc$me35a$formula <- as.character(me35a$call)[2]
auc$me35a$auc <- aucResult(me35a)
```

## Academic: Any
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: residency
- SES: Diez-Rouz, Ethnicity (white)

```{r MEmodel35b}
me35b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + residency, data=train, family="binomial")

# print raw results of regression
summary(me35b)
rocResult(me35b)
auc$me35b$formula <- as.character(me35b$call)[2]
auc$me35b$auc <- aucResult(me35b)
```

## Academic: GU
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Urology Residency
- SES: None

```{r MEmodel36a}
me36a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + residencygu, data=train, family="binomial")

# print raw results of regression
summary(me36a)
rocResult(me36a)
auc$me36a$formula <- as.character(me36a$call)[2]
auc$me36a$auc <- aucResult(me36a)
```

## Academic: GU
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Urology Residency
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel36b}
me36b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + residencygu, data=train, family="binomial")

# print raw results of regression
summary(me36b)
rocResult(me36b)
auc$me36b$formula <- as.character(me36b$call)[2]
auc$me36b$auc <- aucResult(me36b)
```

## Academic: Resident Number
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Number of FTE Residents
- SES: None

```{r MEmodel37a}
me37a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + residentnum, data=train, family="binomial")

# print raw results of regression
summary(me37a)
rocResult(me37a)
auc$me37a$formula <- as.character(me37a$call)[2]
auc$me37a$auc <- aucResult(me37a)
```

## Academic: Resident Number
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital: Number of FTE Residents
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel37b}
me37b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + residentnum, data=train, family="binomial")

# print raw results of regression
summary(me37b)
rocResult(me37b)
auc$me37b$formula <- as.character(me37b$call)[2]
auc$me37b$auc <- aucResult(me37b)
```

# Rural, Distance
## Rural
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Rural

```{r MEmodel40a}
me40a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + ru, data=train, family="binomial")

# print raw results of regression
summary(me40a)
rocResult(me40a)
auc$me40a$formula <- as.character(me40a$call)[2]
auc$me40a$auc <- aucResult(me40a)
```

## HoodZscore, Rural
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Diez-Roux, Ethinicity (% white), Rural

```{r MEmodel40b}
me40b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + ru, data=train, family="binomial")

# print raw results of regression
summary(me40b)
rocResult(me40b)
auc$me40b$formula <- as.character(me40b$call)[2]
auc$me40b$auc <- aucResult(me40b)
```

## Distance
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Distance

```{r MEmodel40c}
me40c <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + km, data=train, family="binomial")

# print raw results of regression
summary(me40c)
rocResult(me40c)
auc$me40c$formula <- as.character(me40c$call)[2]
auc$me40c$auc <- aucResult(me40c)
```

## Distance, HoodZ
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Distance, Hood Z Score, Ethnicity (% White)

```{r MEmodel40d}
me40d <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + km, data=train, family="binomial")

# print raw results of regression
summary(me40d)
rocResult(me40d)
auc$me40d$formula <- as.character(me40d$call)[2]
auc$me40d$auc <- aucResult(me40d)
```

## Distance, Rural
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Distance, Rural

```{r MEmodel40e}
me40e <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + km + ru, data=train, family="binomial")

# print raw results of regression
summary(me40e)
rocResult(me40e)
auc$me40e$formula <- as.character(me40e$call)[2]
auc$me40e$auc <- aucResult(me40e)
```

## Distance, Rural, HoodZ
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Distance, Rural, Hood Zscore, Ethnicity (% White)

```{r MEmodel40f}
me40f <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + km + ru, data=train, family="binomial")

# print raw results of regression
summary(me40f)
rocResult(me40f)
auc$me40f$formula <- as.character(me40f$call)[2]
auc$me40f$auc <- aucResult(me40f)
```

# Hospital Stay Factors
## Approach
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Approach
- SES: none

```{r MEmodel44a}
me44a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + open, data=train, family="binomial")

# print raw results of regression
summary(me44a)
rocResult(me44a)
auc$me44a$formula <- as.character(me44a$call)[2]
auc$me44a$auc <- aucResult(me44a)
```

## Approach, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Approach
- SES: Diez-Roux, Ethnicity (white)

```{r MEmodel44b}
me44b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + open + hoodzscore + ethwhite, data=train, family="binomial")

# print raw results of regression
summary(me44b)
rocResult(me44b)
auc$me44b$formula <- as.character(me44b$call)[2]
auc$me44b$auc <- aucResult(me44b)
```

## Dispo
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Dispo
- SES: none

```{r MEmodel43}
me43 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + disp, data=train, family="binomial")

# print raw results of regression
summary(me43)
rocResult(me43)
auc$me43$formula <- as.character(me43$call)[2]
auc$me43$auc <- aucResult(me43)
```

## HoodZscore, Dispo
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Dispo
- SES: Diez-Roux, EthWhite

```{r MEmodel44}
me44 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + disp, data=train, family="binomial") 

# print raw results of regression
summary(me44)
rocResult(me44)
auc$me44$formula <- as.character(me44$call)[2]
auc$me44$auc <- aucResult(me44)
```

## Payer
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Payer Category
- SES: none

```{r MEmodel45}
me45 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + pay_cat, data=train, family="binomial")

# print raw results of regression
summary(me45)
rocResult(me45)
auc$me45$formula <- as.character(me45$call)[2]
auc$me45$auc <- aucResult(me45)
```

## HoodZscore, Payer
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Payer Category
- SES: Diez-Roux, EthWhite


```{r MEmodel46}
me46 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + pay_cat, data=train, family="binomial") 

# print raw results of regression
summary(me46)
rocResult(me46)
auc$me46$formula <- as.character(me46$call)[2]
auc$me46$auc <- aucResult(me46)
```

## Dispo and Payer
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Dispo, Payer
- SES: none

```{r MEmodel47}
me47 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + disp + pay_cat, data=train, family="binomial")

# print raw results of regression
summary(me47)
rocResult(me47)
auc$me47$formula <- as.character(me47$call)[2]
auc$me47$auc <- aucResult(me47)
```

## HoodZscore, Dispo and Payer
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Dispo, Payer
- SES: Diez-Roux, EthWhite

```{r MEmodel48}
me48 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + disp + pay_cat, data=train, family="binomial") 

# print raw results of regression
summary(me48)
rocResult(me48)
auc$me48$formula <- as.character(me48$call)[2]
auc$me48$auc <- aucResult(me48)
```

## LOS
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS
- SES: none

```{r MEmodel49a}
me49a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + los, data=train, family="binomial") 

# print raw results of regression
summary(me49a)
rocResult(me49a)
auc$me49a$formula <- as.character(me49a$call)[2]
auc$me49a$auc <- aucResult(me49a)
```

## LOS, HoodZscore
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS
- SES: Hood Zscore, Ethnicity (% White)

```{r MEmodel49b}
me49b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + hoodzscore + ethwhite + los, data=train, family="binomial") 

# print raw results of regression
summary(me49b)
rocResult(me49b)
auc$me49b$formula <- as.character(me49b$call)[2]
auc$me49b$auc <- aucResult(me49b)
```

## LOS: Quintile
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS in top quintile
- SES: none

```{r MEmodel50a}
me50a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + loslong5, data=train, family="binomial") 

# print raw results of regression
summary(me50a)
rocResult(me50a)
auc$me50a$formula <- as.character(me50a$call)[2]
auc$me50a$auc <- aucResult(me50a)
```

## LOS Quintile, HoodZscore
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS in top quintile
- SES: Hood Zscore, Ethnicity (% White)

```{r MEmodel50b}
me50b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + loslong5 + hoodzscore + ethwhite + loslong5, data=train, family="binomial") 

# print raw results of regression
summary(me50b)
rocResult(me50b)
auc$me50b$formula <- as.character(me50b$call)[2]
auc$me50b$auc <- aucResult(me50b)
```

## LOS: Decile
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS in top decile
- SES: none

```{r MEmodel51a}
me51a <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + loslong10, data=train, family="binomial") 

# print raw results of regression
summary(me51a)
rocResult(me51a)
auc$me51a$formula <- as.character(me51a$call)[2]
auc$me51a$auc <- aucResult(me51a)
```

## LOS Decile, HoodZscore
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, LOS in top decile
- SES: Hood Zscore, Ethnicity (% White)

```{r MEmodel51b}
me51b <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + loslong10 + hoodzscore + ethwhite + loslong10, data=train, family="binomial") 

# print raw results of regression
summary(me51b)
rocResult(me51b)
auc$me51b$formula <- as.character(me51b$call)[2]
auc$me51b$auc <- aucResult(me51b)
```

## Weekday
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum, Discharge Day of week
- SES: none

```{r MEmodel51}
# me51 <- glm(isreadmit30dc ~ agyradmcentered + sex + open +  elixsum + dschweekday, data=train, family="binomial") 
# 
# # print raw results of regression
# summary(me51)
# rocResult(me51)
# auc$me51$formula <- as.character(me51$call)[2]
# auc$me51$auc <- aucResult(me51)
```

# Composite Models
## base, ses plus
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: Neighborhood Z-Score, Ethnicity (% white)

```{r MEmodel60}
me60 <- glm(isreadmit30dc ~ agyradmcentered + sex + open + elixsum + hoodzscore +  ethwhite + km + ru, data=train, family="binomial")

# print raw results of regression
summary(me60)
rocResult(me60)
auc$me60$formula <- as.character(me60$call)[2]
auc$me60$auc <- aucResult(me60)
```

## Hospital Factors
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- SES: None
- Hospital Factors: volume, beds, residency

```{r MEmodel61}
me61 <- glm(isreadmit30dc ~ agyradmcentered + sex + open + elixsum + volumequint + bedsMean + residency, data=train, family="binomial")

# print raw results of regression
summary(me61)
rocResult(me61)
auc$me61$formula <- as.character(me61$call)[2]
auc$me61$auc <- aucResult(me61)
```

## Hospital Factors
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital Factors: volume quintile, nubmer of hospital beds, academic status
- SES: None

```{r MEmodel62}
me62 <- glm(isreadmit30dc ~ agyradmcentered + sex + open + elixsum + hoodzscore +  ethwhite + volumequint + bedsMean + residency, data=train, family="binomial")

# print raw results of regression
summary(me62)
rocResult(me62)
auc$me62$formula <- as.character(me62$call)[2]
auc$me62$auc <- aucResult(me62)
```

## Hosp Factors, SES
- Outcome: 30 day readmission from date discharge date after index admission
- Predictors: age (10yrs), sex, approach,  Elixhauser Sum
- Hospital Factors: volume quintile, nubmer of hospital beds, academic status
- SES: Neighborhood Z-Score, Ethnicity (% white), distance, rural

```{r MEmodel63}
me63 <- glm(isreadmit30dc ~ agyradmcentered + sex + open + elixsum + hoodzscore +  ethwhite + km + ru + volumequint + bedsMean + residency, data=train, family="binomial")

# print raw results of regression
summary(me63)
rocResult(me63)
auc$me63$formula <- as.character(me63$call)[2]
auc$me63$auc <- aucResult(me63)

```


```{r, eval=F}
    "p_base_sesplus" = glm(isreadmit30dc ~ agyradm + sex + open + elixsum + hoodzscore + ethwhite + ru + km, data=., family="binomial"),
   "p_hospfactors" = glm(isreadmit30dc ~ agyradm + sex + open + elixsum + volumequint + bedsMean + residency, data=., family="binomial"),
      "p_hospfactors_ses" = glm(isreadmit30dc ~ agyradm + sex + open + elixsum + volumequint + bedsMean + residency + hoodzscore + ethwhite, data=., family="binomial")

```


```{r, cache=F}
# Misc Code
# Calculate confidence intervals and odds ratios for log fixed effects models
# kable(exp(cbind(OR = coef(m2), confint(m2))))

# Calculate confidence intervals and odds ratios for mixed effects models
# me8ci <- confint(me8, parm = "beta_")
# kable(exp(cbind(OR=fixef(me5))))

# interaction with comorbidity
# O/E for each specific hospital
# break up hospitals into quintiles
# train model in top volume quintile, apply to all hospitals or lower quintiles

# cluster on volume quintile?!

############## ADD IN-HOSPITAL DEATHS?

# proportion of residents to average daily census?!

# maybe no need to use hospital as random effect because 
# auc relative values 

# look at outcomes/trends in safety net hospitals? 
# table of patient characteristics by safety net/not, patterns over time, readmissions and in-hospital deaths by cancer 


# round(prop.table(table(ptgu$disp, ptgu$cohort),2)*100,2)
auc <- as.data.frame(do.call(rbind, auc))
datatable(auc)
```
